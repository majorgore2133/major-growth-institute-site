<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MGI Client Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--blue:#0b5fa5;--dark:#0b2d4a;--gold:#caa43b;--ink:#142433;--muted:#6b7b8c;--paper:#fff;--soft:#f5f8fc;--bd:#e6eef6}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#f7fbff,#fff);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--ink)}
header{background:#003366;color:#fff;padding:16px;text-align:center;font-weight:700}
.container{max-width:1100px;margin:18px auto;padding:0 14px}
.nav{display:flex;gap:10px;flex-wrap:wrap}
.tab{padding:10px 14px;border:1px solid var(--bd);border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
.tab.active{background:linear-gradient(180deg,#fff,#f4f8ff);border-color:#cddff3;box-shadow:0 8px 22px rgba(11,95,165,.12)}
.grid{display:grid;gap:16px}
.two{grid-template-columns:1.2fr .8fr}
@media(max-width:980px){.two{grid-template-columns:1fr}}
.card{background:#fff;border:1px solid var(--bd);border-radius:14px;box-shadow:0 12px 32px rgba(8,68,120,.08);padding:16px}
h2{margin:4px 0 10px;color:#0b2d4a}
h3{margin:8px 0}
p.mini{color:var(--muted);font-size:12px;margin:6px 0}
.row{display:flex;gap:10px;flex-wrap:wrap}
.input, select, textarea{width:100%;padding:10px;border:1px solid var(--bd);border-radius:10px;background:#fff}
.badge{display:inline-block;background:#eef5fb;color:#0b5fa5;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:700}
.btn{background:var(--blue);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;box-shadow:0 12px 28px rgba(11,95,165,.16)}
.btn.gold{background:var(--gold);color:#1b2330}
.btn.ghost{background:#fff;border:2px solid #e1ecf6;color:#0b2d4a}
.pill{display:inline-block;padding:8px 10px;border-radius:10px;background:#fcfdff;border:1px solid #e7eff7;margin:4px 6px 0 0}
.progress{height:10px;background:#eaf2fb;border-radius:999px;overflow:hidden}
.progress > span{display:block;height:100%;background:linear-gradient(90deg,#0b5fa5,#4aa3ff)}
footer{margin:26px 0 20px;text-align:center;color:#6b7b8c}
</style>
</head>
<body>
<header>Major Growth Institute — Client Dashboard</header>
<div class="container">

  <!-- Top bar -->
  <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:12px">
    <div><span class="badge" id="who"></span></div>
    <div class="row" style="gap:8px">
      <button id="logout" class="btn gold">Log out</button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="nav" id="tabs">
    <div class="tab active" data-tab="overview">Overview</div>
    <div class="tab" data-tab="analyzer">Analyzer</div>
    <div class="tab" data-tab="reports">Reports</div>
    <div class="tab" data-tab="progress">Progress</div>
    <div class="tab" data-tab="support">Support</div>
  </div>

  <!-- Panels -->
  <div id="panel-overview" class="grid two" style="margin-top:14px">
    <div class="card">
      <h2>Welcome</h2>
      <p class="mini">Your central hub for repair, building, and funding.</p>
      <div class="row" style="margin-top:8px">
        <a class="btn" href="#analyzer" onclick="selectTab('analyzer')">Start Analysis</a>
        <a class="btn ghost" href="#reports" onclick="selectTab('reports')">See Lenders</a>
      </div>
      <div style="margin-top:16px">
        <h3>Upgrade Options</h3>
        <div class="row">
          <a class="btn gold" href="https://buy.stripe.com/test_00w6oJ5SEd0LgjI39453O00" target="_blank" rel="noopener">Book Consultation ($100)</a>
          <a class="btn" href="https://buy.stripe.com/test_6oU5kFepa0dZd7wcJE53O01" target="_blank" rel="noopener">Full Service Package ($1000)</a>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="badge">At a glance</div>
      <h3>Funding Readiness</h3>
      <div class="progress"><span id="bar-fund" style="width:0%"></span></div>
      <p class="mini" id="fund-note">Complete the analyzer to see your readiness.</p>
      <h3 style="margin-top:12px">Credit Repair</h3>
      <div class="progress"><span id="bar-repair" style="width:0%"></span></div>
      <p class="mini" id="repair-note">We’ll calculate this from your inputs.</p>
    </div>
  </div>

  <div id="panel-reports" class="card" style="display:none;margin-top:14px">
    <div class="badge">Lender Finder (powered by your proxy)</div>
    <div class="row" style="margin-top:8px">
      <select id="stateSel" class="input"></select>
      <button class="btn" onclick="fetchLenders()">Find Lenders</button>
      <button class="btn ghost" onclick="detectLocation()">Detect My Location</button>
    </div>
    <p class="mini">We’ll tailor lenders by state. (First time? Click “Detect My Location”.)</p>
    <div id="lenders" style="margin-top:12px"></div>
  </div>

  <footer>© Major Growth Institute</footer>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<script>
const PROXY = "https://majorgrowthproxy.laxfreaked.workers.dev";

const STATES=["AL","AK","AZ","AR","CA","CO","CT","DC","DE","FL","GA","HI","IA","ID","IL","IN","KS","KY","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","ND","NE","NH","NJ","NM","NV","NY","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VA","VT","WA","WI","WV","WY"];

function loadStates(){
  const sel=document.getElementById('stateSel'); 
  sel.innerHTML="";
  STATES.forEach(s=>{
    const o=document.createElement('option');
    o.value=s;
    o.textContent=s;
    sel.appendChild(o);
  });
  sel.value="TX";
}

async function detectLocation(){
  try{
    const r=await fetch("https://ipapi.co/json/");
    const j=await r.json(); 
    const state=(j.region_code||"").toUpperCase();
    if(STATES.includes(state)) document.getElementById('stateSel').value=state;
  }catch(e){ alert("Could not detect location."); }
}

async function fetchLenders() {
  const state=document.getElementById("stateSel").value;
  const el=document.getElementById("lenders");
  el.innerHTML = "Loading lenders…";

  try {
    const resp = await fetch(`${PROXY}/?state=${state}`);
    const data = await resp.json();

    if (!Array.isArray(data) || data.length === 0) {
      el.innerHTML = "No lenders found or failed to load data.";
      return;
    }

    el.innerHTML = data.slice(0, 30).map(
      x => `
        <div class="pill" style="padding:8px;border-bottom:1px solid #ccc">
          <strong>${x.name}</strong> – ${x.city || "Unknown"} (${x.assets || "N/A"})
        </div>
      `
    ).join("");
  } catch (err) {
    console.error(err);
    el.innerHTML = "Error fetching lender list.";
  }
}

loadStates();
</script>
</body>
</html>
